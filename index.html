<html>
<head>
    <title>tank game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.2.4/pixi.min.js" integrity="sha512-Ch/O6kL8BqUwAfCF7Ie5SX1Hin+BJgYH4pNjRqXdTEqMsis1TUYg+j6nnI9uduPjGaj7DN4UKCZgpvoExt6dkw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
    <body>
        <script>
            const app = new PIXI.Application({ background: '#1099bb', resizeTo: window });
            document.body.appendChild(app.view);

            let myid = null;
            let renderer = null;
            let stage = null;
            let board = null;
            let tanks = {};
            const ws = new WebSocket("ws://74.208.107.245:32123");

            ws.addEventListener("open", () => {
                ws.send('{"id":0,"action":"NEW"}');
            });

            ws.addEventListener("message", (event) => {
                let rep = null;
                try {
                    rep = JSON.parse(event.data);
                } catch (e) {
                    console.log("invalid reply");
                    return;
                }

                if ("type" in rep) {
                    switch (rep.type) {
                        case "new":
                            myid = rep.id;
                            board = rep.board;
                            renderer = PIXI.autoDetectRenderer(rep.width, rep.height);
                            document.body.appendChild(renderer.view);
                            stage = new PIXI.Container();
                            renderer.render(stage);

                            ws.send('{"id":'+myid+',"action":"NW"}')
                            break;
                        case "tank":
                            if (!(rep.id in tanks)) {
                                let gr = new PIXI.Graphics();
                                gr.lineStyle(2, 0x993333);
                                gr.beginFill(0xFFFFFF);
                                gr.drawCircle(0, 0, 11);
                                gr.endFill();
                                let texture = renderer.generateTexture(gr);
                                tanks[rep.id] = new PIXI.Sprite(texture);  
                                stage.addChild(tanks[rep.id]);
                                renderer.render(stage);
                            }
                            tanks[rep.id].x = rep.x;
                            tanks[rep.id].y = rep.y;

                            break;
                        case "update":
                            break;
                        default: break;
                    }
                }
            });


            
        </script>
    </body>
</html>

